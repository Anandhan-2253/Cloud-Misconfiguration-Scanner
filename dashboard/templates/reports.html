{% extends "base.html" %}
{% from "partials/macros.html" import risk_badge %}

{% block content %}
<section class="flex items-start justify-between gap-6 mb-8">
    <div>
        <h1 class="text-2xl font-semibold tracking-tight">Reports</h1>
        <p class="text-muted mt-1">Downloaded HTML reports from completed audits.</p>
    </div>
    <div class="glass-panel px-4 py-3 rounded-lg text-right">
        <div class="text-xs uppercase text-muted tracking-wide">Last scan</div>
        <div class="mono text-sm">{{ last_scan or "No scans recorded" }}</div>
    </div>
</section>

<section class="glass-panel rounded-2xl p-5 shadow-soc">
    <div class="flex items-center justify-between mb-4">
        <h2 class="text-lg font-semibold">Generated Reports</h2>
        <span class="text-xs text-muted mono">{{ reports | length }} total</span>
    </div>

    {% if not reports %}
        <div class="text-muted text-sm">No reports yet. Run a scan to generate your first assessment.</div>
    {% else %}
        <div class="overflow-auto scrollbar-thin">
            <table class="w-full text-sm border-separate border-spacing-0">
                <thead class="sticky top-0 bg-[#0b1220]">
                    <tr>
                        <th class="text-left p-3 text-xs uppercase tracking-widest text-muted border-b border-border">Timestamp</th>
                        <th class="text-left p-3 text-xs uppercase tracking-widest text-muted border-b border-border">Summary</th>
                        <th class="text-left p-3 text-xs uppercase tracking-widest text-muted border-b border-border">Critical</th>
                        <th class="text-left p-3 text-xs uppercase tracking-widest text-muted border-b border-border">High</th>
                        <th class="text-left p-3 text-xs uppercase tracking-widest text-muted border-b border-border">Medium</th>
                        <th class="text-left p-3 text-xs uppercase tracking-widest text-muted border-b border-border">Low</th>
                        <th class="text-left p-3 text-xs uppercase tracking-widest text-muted border-b border-border">Download</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in reports %}
                    <tr class="border-b border-border">
                        <td class="p-3 mono text-xs">{{ r.created_at }}</td>
                        <td class="p-3">{{ r.summary }}</td>
                        <td class="p-3 text-critical mono">{{ r.counts.Critical }}</td>
                        <td class="p-3 text-high mono">{{ r.counts.High }}</td>
                        <td class="p-3 text-medium mono">{{ r.counts.Medium }}</td>
                        <td class="p-3 text-low mono">{{ r.counts.Low }}</td>
                        <td class="p-3">
                            <a class="underline text-muted mono text-xs" href="{{ url_for('report', filename=r.report_name) }}">Download HTML</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    {% endif %}
</section>
{% endblock %}
